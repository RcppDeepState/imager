<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Generating ASCII art using imager and ggplot2</title>

<script src="ascii_art_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="ascii_art_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="ascii_art_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="ascii_art_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="ascii_art_files/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="ascii_art_files/highlight/default.css"
      type="text/css" />
<script src="ascii_art_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="ascii_art_files/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Generating ASCII art using imager and ggplot2</h1>

</div>


<p><a href="https://en.wikipedia.org/wiki/ASCII_art">ASCII art</a> is the art of drawing pictures using text (specifically, the 128 characters allowed by standard ASCII). In this example we’ll see how to use imager to render pictures into ASCII, in the manner of image-to-ASCII converters like <em>AAlib</em>.</p>
<p>We’ll be using imager and tools from the tidyverse, and an image of a flower as an example:</p>
<pre class="r"><code>##The tidyverse package loads dplyr, purrr, etc. 
library(tidyverse)
library(imager)
##Optional: cowplot has nicer defaults for ggplot
library(cowplot) </code></pre>
<pre><code>## Warning: `legend.margin` must be specified using `margin()`. For the old
## behavior use legend.spacing</code></pre>
<pre class="r"><code>im &lt;- load.image(&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/f/fd/Aster_Tataricus.JPG/1024px-Aster_Tataricus.JPG&quot;) 
plot(im)</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-1-1.png" width="624" /></p>
<p>The first strategy we’ll explore is to render pixels as characters, using darker characters for darker pixels.</p>
<p>First, we generate a set of ASCII characters:</p>
<pre class="r"><code>asc &lt;- gtools::chr(38:126) #We use a subset of ASCII, R doesn&#39;t render the rest
head(asc,10)</code></pre>
<pre><code>##  [1] &quot;&amp;&quot; &quot;&#39;&quot; &quot;(&quot; &quot;)&quot; &quot;*&quot; &quot;+&quot; &quot;,&quot; &quot;-&quot; &quot;.&quot; &quot;/&quot;</code></pre>
<p>Next, we measure how dark these characters by having R draw them on an image, then by computing the average image lightness: for this we use imager’s implot function, which uses R base graphics to plot things on images.</p>
<pre class="r"><code>#Draw some text on a white background: 
txt &lt;- imfill(50,50,val=1) %&gt;% implot(text(20,20,&quot;Blah&quot;)) 
txt</code></pre>
<pre><code>## Image. Width: 50 pix Height: 50 pix Depth: 1 Colour channels: 3</code></pre>
<pre class="r"><code>plot(txt,interp=FALSE)</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-3-1.png" width="624" /></p>
<pre class="r"><code>##A function that plots a single character and measures its lightness

g.chr &lt;- function(chr) implot(imfill(50,50,val=1),text(25,25,chr,cex=5)) %&gt;% grayscale %&gt;% mean
g &lt;- map_dbl(asc,g.chr)
n &lt;- length(g)
plot(1:n,sort(g),type=&quot;n&quot;,xlab=&quot;Order&quot;,ylab=&quot;Lightness&quot;)
text(1:n,sort(g),asc[order(g)])</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-3-2.png" width="624" /></p>
<p>The plot shows the characters on an axis of increasing lightness. To render the image we’ll quantise the grayscale levels into as many bins as we have characters, and plot the result:</p>
<pre class="r"><code>#Sort the characters by increasing lightness
char &lt;- asc[order(g)]
#Convert image to grayscale, resize, convert to data.frame
d &lt;- grayscale(im) %&gt;% imresize(.1)  %&gt;% as.data.frame
#Quantise
d &lt;- mutate(d,qv=cut_number(value,n) %&gt;% as.integer)
#Assign a character to each quantised level
d &lt;- mutate(d,char=char[qv])
#Plot
ggplot(d,aes(x,y))+geom_text(aes(label=char),size=1)+scale_y_reverse()</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-4-1.png" width="624" /></p>
<p>So far we have matched pixels to characters based on their average lightness. We could go on to match <em>image patches</em> to characters, finding the character that is most similar to each image patch. The following piece of code implements this idea, but, for a change, instead of ASCII characters we’ll use R’s set of plotting symbols.</p>
<p>The first step is to divide the image into patches:</p>
<pre class="r"><code>#psize is the patch size in pixels (we&#39;ll use odd patch sizes for simplicity)
psize &lt;- 5
#center of the patch
cen &lt;- ceiling(psize/2)

#produces a grid of coordinates for the center of each patch
gr &lt;- grayscale(im) %&gt;% pixel.grid %&gt;%
    filter((x %% psize)==cen,(y %% psize) == cen)

plot(im,xlim=c(200,250),ylim=c(200,250))
with(gr,points(x,y,cex=1,col=&quot;red&quot;))</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-5-1.png" width="624" /></p>
<pre class="r"><code>#extract an image patch at each point on the grid
ptch &lt;- extract_patches(im,gr$x,gr$y,psize,psize)

#NB: ptch is an image list, in which each element is an image patch
ptch</code></pre>
<pre><code>## Image list of size 41205</code></pre>
<p>The second step is to render all characters as image patches of the same size:</p>
<pre class="r"><code>syms &lt;- 1:25

render &lt;- function(sym) implot(imfill(psize,psize,val=1),points(cen,cen,pch=sym,cex=1)) %&gt;% grayscale
ptch.c &lt;- map(syms,render)
plot(ptch.c[[4]],interp=FALSE)</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-6-1.png" width="624" /></p>
<p>Of course at that resolution the rendering of each letter is bound to be pretty crummy (the above is supposed to be “A”).</p>
<p>The third step is to match each image patch to the character it most resembles. For that we’ll use the excellent nearest neighbour function from the <em>nabor</em> package:</p>
<pre class="r"><code>#Convert patches to a long matrix 
Pim &lt;- map(ptch,as.vector) %&gt;% do.call(rbind,.) 
Pc &lt;- map(ptch.c,as.vector) %&gt;% do.call(rbind,.)
nn &lt;- nabor::knn(Pc,Pim,1)$nn.idx
mutate(gr,sym=syms[nn]) %$% plot(x,y,pch=sym,cex=.2,ylim=c(height(im),1))</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-7-1.png" width="624" /></p>
<p>I’ll admit, this isn’t the prettiest flower, but there you go. Feel free to improve.</p>
<p>For the reader’s entertainment, I’m adding a last piece of code along the same lines: it reconstructs an image using a collection of patches (for instance, patches extracted from another image).</p>
<pre class="r"><code>##Extract patches of a given size
extract.all &lt;- function(im,psize=5)
    {
        cen &lt;- ceiling(psize/2)
        gr &lt;- pixel.grid(R(im)) %&gt;% filter((x %% psize)==cen,(y %% psize) == cen) 
        extract_patches(im,gr$x,gr$y,psize,psize)
    }

match.patches &lt;- function(dict,im)
{
    psize &lt;- height(dict[[1]]) #Patches are assumed to be square
    ##Resize to make sure the image can be cut into an integer number of patches
    im &lt;- resize(im,(width(im) %/% psize)*psize,(height(im) %/% psize)*psize)
    
    pim &lt;- extract.all(im,psize)
    Pa &lt;- map(dict,as.vector) %&gt;% do.call(rbind,.)
    Pb &lt;-  map(pim,as.vector) %&gt;% do.call(rbind,.)
    nn &lt;- nabor::knn(Pa,Pb,1)$nn.idx %&gt;% c
    imappend(dict[nn],&quot;x&quot;) %&gt;% imsplit(&quot;x&quot;,-width(im)) %&gt;% imappend(&quot;y&quot;) 
}

##Render the R logo using image patches extracted from the &quot;parrots&quot; image
dict &lt;- load.example(&quot;parrots&quot;) %&gt;% extract.all(7)
im &lt;- imager::load.image(&quot;https://cran.r-project.org/Rlogo.jpg&quot;)
match.patches(dict,im) %&gt;% plot</code></pre>
<p><img src="ascii_art_files/figure-html/unnamed-chunk-8-1.png" width="624" /></p>
<pre class="r"><code>##Render &quot;tennis&quot; as ASCII art
render &lt;- function(chr) implot(imfill(psize,psize,val=1),text(cen,cen,chr,cex=.8)) %&gt;% grayscale
tennis &lt;- load.example(&quot;tennis&quot;)/255
dict &lt;- map_il(asc,render)
tennis.asc &lt;- imsplit(tennis,&quot;z&quot;) %&gt;% map(~ match.patches(dict,.))  %&gt;% imappend(&quot;z&quot;)</code></pre>
<video width="500"  controls loop>
<source src="ascii_art_files/tennis_ascii.webm" />
<p>
The tennis video, rendered in ASCII
</p>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
